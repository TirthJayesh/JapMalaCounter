<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Counter App</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
<style type="text/tailwindcss">
        :root {
            --background-color: #f0f2f5;
            --text-color: #111418;
            --gradient-start: #10B981;
            --gradient-end: #047857;
            --card-bg: #ffffff;
            --progress-bg: #e5e7eb;
            --progress-fill: #10B981;
            --achievement-bg: #ffffff;
            --achievement-border: #e5e7eb;
            --achievement-text: #111418;
            --popup-bg: rgba(0, 0, 0, 0.5);
            --popup-card-bg: #ffffff;
            --unlocked-icon-color: #f59e0b;
            --locked-icon-color: #9ca3af;
            --calendar-day-bg: #e5e7eb;
            --calendar-day-text: #111418;
            --calendar-active-day-bg: #10B981;
            --calendar-active-day-text: #ffffff;
             --calendar-selected-day-bg: #047857;
        }
        .dark-theme {
            --background-color: #121212;
            --text-color: #ffffff;
            --gradient-start: #10B981;
            --gradient-end: #047857;
            --card-bg: #1e1e1e;
            --progress-bg: #374151;
            --progress-fill: #10B981;
            --achievement-bg: #1e1e1e;
            --achievement-border: #374151;
            --achievement-text: #ffffff;
            --popup-card-bg: #2d2d2d;
            --unlocked-icon-color: #f59e0b;
            --locked-icon-color: #6b7280;
            --calendar-day-bg: #374151;
            --calendar-day-text: #ffffff;
            --calendar-active-day-bg: #10B981;
            --calendar-active-day-text: #ffffff;
            --calendar-selected-day-bg: #047857;
        }
        .light-theme {
            --background-color: #f0f2f5;
            --text-color: #111418;
            --gradient-start: #10B981;
            --gradient-end: #047857;
            --card-bg: #ffffff;
            --progress-bg: #e5e7eb;
            --progress-fill: #10B981;
            --achievement-bg: #ffffff;
            --achievement-border: #e5e7eb;
            --achievement-text: #111418;
            --popup-card-bg: #ffffff;
            --unlocked-icon-color: #f59e0b;
            --locked-icon-color: #9ca3af;
            --calendar-day-bg: #e5e7eb;
            --calendar-day-text: #111418;
            --calendar-active-day-bg: #10B981;
            --calendar-active-day-text: #ffffff;
            --calendar-selected-day-bg: #047857;
        }
        body {
            font-family: "Inter", sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        .material-symbols-outlined {
            font-variation-settings:
            'FILL' 0,
            'wght' 400,
            'GRAD' 0,
            'opsz' 48
        }
        .material-symbols-outlined.custom-settings {
            font-variation-settings:
            'FILL' 0,
            'wght' 300,
            'GRAD' 0,
            'opsz' 48
        }
        .achievement-icon {
            font-variation-settings:
            'FILL' 1,
            'wght' 400,
            'GRAD' 0,
            'opsz' 48
        }
    </style>
<script>
        let count = 40;
        let level = 0;
        let MALA_TARGET = 108;
        let malaHistory = [{ "malaNumber": 1, "timestamp": "2024-05-01T10:00:00.000Z" }, { "malaNumber": 2, "timestamp": "2024-05-01T14:30:00.000Z" }, { "malaNumber": 3, "timestamp": "2024-05-03T09:15:00.000Z" }, { "malaNumber": 4, "timestamp": "2024-05-15T18:00:00.000Z" }];
        const achievements = [{
            mala: 1,
            title: "First Steps",
            icon: "footprint",
            description: "Complete your first Mala."
        }, {
            mala: 10,
            title: "Apprentice",
            icon: "school",
            description: "Complete 10 Malas. The journey continues."
        }, {
            mala: 50,
            title: "Adept",
            icon: "military_tech",
            description: "Complete 50 Malas. Your focus sharpens."
        }, {
            mala: 108,
            title: "Master",
            icon: "workspace_premium",
            description: "Complete 108 Malas. You've achieved mastery."
        }, {
            mala: 500,
            title: "Grandmaster",
            icon: "emoji_events",
            description: "Complete 500 Malas. A true devotee."
        }, {
            mala: 1008,
            title: "Enlightened",
            icon: "self_improvement",
            description: "Complete 1008 Malas. You are one with the universe."
        }, ];
        let unlockedAchievements = [];
        function saveProgress() {
            localStorage.setItem('counterAppProgress', JSON.stringify({
                count,
                level,
                unlockedAchievements,
                malaTarget: MALA_TARGET,
                malaHistory,
            }));
        }
        function loadProgress() {
            const savedProgress = JSON.parse(localStorage.getItem('counterAppProgress'));
            if (savedProgress) {
                count = savedProgress.count || 0;
                level = savedProgress.level || 0;
                unlockedAchievements = savedProgress.unlockedAchievements || [];
                MALA_TARGET = savedProgress.malaTarget || 108;
                malaHistory = savedProgress.malaHistory || [{ "malaNumber": 1, "timestamp": "2024-05-01T10:00:00.000Z" }, { "malaNumber": 2, "timestamp": "2024-05-01T14:30:00.000Z" }, { "malaNumber": 3, "timestamp": "2024-05-03T09:15:00.000Z" }, { "malaNumber": 4, "timestamp": "2024-05-15T18:00:00.000Z" }];
            } else {
                count = 40;
                level = 0;
                unlockedAchievements = [];
                MALA_TARGET = 108;
                malaHistory = [{ "malaNumber": 1, "timestamp": "2024-05-01T10:00:00.000Z" }, { "malaNumber": 2, "timestamp": "2024-05-01T14:30:00.000Z" }, { "malaNumber": 3, "timestamp": "2024-05-03T09:15:00.000Z" }, { "malaNumber": 4, "timestamp": "2024-05-15T18:00:00.000Z" }];
            }
        }
        function updateDisplay() {
            document.getElementById('counter').innerText = count;
            document.getElementById('mala').innerText = level;
            document.getElementById('goalText').innerText = `Goal: ${MALA_TARGET}`;
            updateProgressBar();
            updateAchievements();
            updateHistory();
            saveProgress();
        }
        function updateProgressBar() {
            const progress = (count / MALA_TARGET) * 100;
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            progressBar.style.width = `${progress}%`;
            progressText.innerText = `${Math.round(progress)}%`;
        }
        function increment() {
            count++;
            if (count > MALA_TARGET) {
                count = 1;
                level++;
                logMalaCompletion();
                checkAchievements();
            }
            updateDisplay();
        }
        function decrement() {
            if (count > 0) {
                count--;
            } else if (level > 0) {
                level--;
                count = MALA_TARGET;
                malaHistory.pop();
            }
            updateDisplay();
        }
        function reset() {
            count = 0;
            level = 0;
            unlockedAchievements = [];
            malaHistory = [];
            updateDisplay();
        }
        function toggleTheme() {
            const body = document.body;
            if (body.classList.contains('light-theme')) {
                body.classList.remove('light-theme');
                body.classList.add('dark-theme');
                localStorage.setItem('theme', 'dark');
            } else {
                body.classList.remove('dark-theme');
                body.classList.add('light-theme');
                localStorage.setItem('theme', 'light');
            }
        }
        function checkAchievements() {
            achievements.forEach(achievement => {
                if (level >= achievement.mala && !unlockedAchievements.some(unlocked => unlocked.title === achievement.title)) {
                    unlockedAchievements.push(achievement);
                    showAchievementPopup(achievement);
                }
            });
        }
        function updateAchievements() {
            const achievementsList = document.getElementById('achievementsList');
            if (!achievementsList) return;
            achievementsList.innerHTML = '';
            achievements.forEach(achievement => {
                const isUnlocked = unlockedAchievements.some(unlocked => unlocked.title === achievement.title);
                const li = document.createElement('li');
                li.className = `flex items-center p-4 rounded-2xl transition-all duration-300 ${isUnlocked ? 'bg-[var(--achievement-bg)] border border-[var(--achievement-border)] shadow-sm' : 'bg-transparent opacity-60'}`;
                li.innerHTML = `
                    <div class="relative flex-shrink-0">
                        <div class="w-14 h-14 rounded-full flex items-center justify-center ${isUnlocked ? 'bg-gradient-to-br from-yellow-400 to-amber-500' : 'bg-gray-200 dark:bg-gray-700'}">
                            <span class="material-symbols-outlined achievement-icon text-3xl ${isUnlocked ? 'text-white' : 'text-[var(--locked-icon-color)]'}">${achievement.icon}</span>
                        </div>
                    </div>
                    <div class="ml-4 flex-grow">
                        <p class="font-bold text-lg text-[var(--achievement-text)]">${achievement.title}</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400">${achievement.description}</p>
                    </div>
                    <div class="text-right ml-2 flex-shrink-0">
                       <p class="text-xs font-semibold ${isUnlocked ? 'text-[var(--gradient-start)]' : 'text-gray-400 dark:text-gray-500'}">
                        ${achievement.mala} Malas
                       </p>
                    </div>
                `;
                achievementsList.appendChild(li);
            });
        }
        function showAchievementPopup(achievement) {
            const popup = document.getElementById('achievementPopup');
            const popupIcon = document.getElementById('popupIcon');
            const popupTitle = document.getElementById('popupTitle');
            const popupMala = document.getElementById('popupMala');
            popupIcon.innerText = achievement.icon;
            popupTitle.innerText = achievement.title;
            popupMala.innerText = `You've unlocked a new achievement!`;
            popup.classList.remove('hidden');
            setTimeout(() => {
                popup.classList.add('hidden');
            }, 3000);
        }
        function toggleAchievements() {
            const achievementsSection = document.getElementById('achievementsSection');
            achievementsSection.classList.toggle('hidden');
            achievementsSection.classList.toggle('flex');
            updateAchievements();
        }
        function toggleSettings() {
            const settingsSection = document.getElementById('settingsSection');
            const settingsPanel = settingsSection.querySelector('div');
            const isHidden = settingsSection.classList.contains('hidden');
            document.getElementById('customGoalInput').value = MALA_TARGET;
            if (isHidden) {
                settingsSection.classList.remove('hidden');
                settingsSection.classList.add('flex');
                setTimeout(() => {
                    settingsPanel.style.transform = 'translateY(0)';
                }, 10);
            } else {
                settingsPanel.style.transform = 'translateY(100%)';
                setTimeout(() => {
                    settingsSection.classList.add('hidden');
                    settingsSection.classList.remove('flex');
                }, 300);
            }
        }
        function setCustomGoal() {
            const input = document.getElementById('customGoalInput');
            const newGoal = parseInt(input.value, 10);
            if (!isNaN(newGoal) && newGoal > 0) {
                MALA_TARGET = newGoal;
                if (count >= MALA_TARGET) {
                    count = 0;
                    level++;
                    logMalaCompletion();
                }
                updateDisplay();
                toggleSettings();
            } else {
                alert('Please enter a valid number for the goal.');
            }
        }
        function logMalaCompletion() {
            const now = new Date();
            malaHistory.unshift({
                malaNumber: level,
                timestamp: now.toISOString()
            });
        }
        let currentDisplayDate = new Date();
        let historyFilter = 'all';
        function updateHistory(filter = historyFilter) {
            historyFilter = filter;
            renderCalendar(currentDisplayDate);
            showHistoryForDate(currentDisplayDate);
        }
        function renderCalendar(date) {
            const calendarView = document.getElementById('calendarView');
            if (!calendarView) return;
            calendarView.innerHTML = '';
            const year = date.getFullYear();
            const month = date.getMonth();
            const monthYearHeader = document.getElementById('monthYearHeader');
            monthYearHeader.innerText = date.toLocaleString('default', { month: 'long', year: 'numeric' });
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const calendarGrid = document.createElement('div');
            calendarGrid.className = 'grid grid-cols-7 gap-2 text-center';
            const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            daysOfWeek.forEach(day => {
                const dayEl = document.createElement('div');
                dayEl.className = 'font-semibold text-sm text-gray-500 dark:text-gray-400';
                dayEl.innerText = day;
                calendarGrid.appendChild(dayEl);
            });
            for (let i = 0; i < firstDay; i++) {
                calendarGrid.appendChild(document.createElement('div'));
            }
            for (let day = 1; day <= daysInMonth; day++) {
                const dayEl = document.createElement('div');
                const currentDate = new Date(year, month, day);
                const dateString = currentDate.toISOString().split('T')[0];
                const malasOnThisDay = malaHistory.filter(entry => entry.timestamp.startsWith(dateString));
                dayEl.className = `h-10 w-10 flex items-center justify-center rounded-full cursor-pointer transition-all duration-200`;
                dayEl.innerText = day;
                if (malasOnThisDay.length > 0) {
                    dayEl.classList.add('bg-[var(--calendar-active-day-bg)]', 'text-[var(--calendar-active-day-text)]', 'font-bold');
                    dayEl.onclick = () => showHistoryForDate(currentDate);
                } else {
                    dayEl.classList.add('bg-[var(--calendar-day-bg)]', 'text-[var(--calendar-day-text)]');
                }
                const today = new Date();
                if(day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                     dayEl.classList.add('ring-2', 'ring-offset-2', 'ring-[var(--gradient-end)]', 'ring-offset-[var(--popup-card-bg)]');
                }
                calendarGrid.appendChild(dayEl);
            }
            calendarView.appendChild(calendarGrid);
        }
        function showHistoryForDate(date) {
             const allDays = document.querySelectorAll('#calendarView > div > div');
             allDays.forEach(el => {
                 el.classList.remove('bg-[var(--calendar-selected-day-bg)]', 'text-white');
                 const day = parseInt(el.innerText);
                 if (!isNaN(day)) {
                     const dateString = new Date(date.getFullYear(), date.getMonth(), day).toISOString().split('T')[0];
                     const malasOnThisDay = malaHistory.filter(entry => entry.timestamp.startsWith(dateString));
                     if(malasOnThisDay.length > 0 && day === date.getDate()) {
                         el.classList.add('bg-[var(--calendar-selected-day-bg)]', 'text-white');
                     }
                 }
             })
            const historyListView = document.getElementById('historyListView');
            historyListView.innerHTML = '';
            const searchInput = document.getElementById('historySearchInput');
            const searchTerm = searchInput.value.toLowerCase();
            let filteredHistory = malaHistory;
            if (historyFilter === 'today') {
                const todayString = new Date().toISOString().split('T')[0];
                filteredHistory = malaHistory.filter(entry => entry.timestamp.startsWith(todayString));
            } else if (historyFilter === 'this_week') {
                const today = new Date();
                const startOfWeek = new Date(today.setDate(today.getDate() - today.getDay()));
                const endOfWeek = new Date(today.setDate(today.getDate() - today.getDay() + 6));
                filteredHistory = malaHistory.filter(entry => {
                    const entryDate = new Date(entry.timestamp);
                    return entryDate >= startOfWeek && entryDate <= endOfWeek;
                });
            } else if (historyFilter === 'this_month') {
                const today = new Date();
                const year = today.getFullYear();
                const month = today.getMonth();
                filteredHistory = malaHistory.filter(entry => {
                    const entryDate = new Date(entry.timestamp);
                    return entryDate.getFullYear() === year && entryDate.getMonth() === month;
                });
            }
            if(searchTerm){
                filteredHistory = filteredHistory.filter(entry => {
                   const entryDate = new Date(entry.timestamp);
                   const dateString = entryDate.toLocaleDateString(undefined, { weekday: 'long', month: 'long', day: 'numeric' });
                   const malaString = `Mala ${entry.malaNumber}`;
                   return dateString.toLowerCase().includes(searchTerm) || malaString.toLowerCase().includes(searchTerm);
                });
            }
            if (filteredHistory.length === 0) {
                historyListView.innerHTML = `<li class="text-center text-gray-500 dark:text-gray-400 py-4">No activity found.</li>`;
            } else {
                filteredHistory.forEach(entry => {
                    const li = document.createElement('li');
                    li.className = `flex items-center justify-between p-4 rounded-2xl bg-[var(--achievement-bg)] border border-[var(--achievement-border)] shadow-sm`;
                    const entryDate = new Date(entry.timestamp);
                    const formattedTime = entryDate.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });
                    li.innerHTML = `
                        <div class="flex items-center">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center bg-gradient-to-br from-[var(--gradient-start)] to-[var(--gradient-end)] text-white font-bold text-lg">
                                ${entry.malaNumber}
                            </div>
                            <div class="ml-4">
                                <p class="font-bold text-lg text-[var(--achievement-text)]">Mala ${entry.malaNumber} Completed</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">${entryDate.toLocaleDateString(undefined, { weekday: 'long', month: 'long', day: 'numeric' })}</p>
                            </div>
                        </div>
                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">${formattedTime}</p>
                    `;
                    historyListView.appendChild(li);
                });
            }
        }
        function changeMonth(offset) {
            currentDisplayDate.setMonth(currentDisplayDate.getMonth() + offset);
            renderCalendar(currentDisplayDate);
        }
        function toggleHistory() {
            const historySection = document.getElementById('historySection');
            const historyPanel = historySection.querySelector('div');
            const isHidden = historySection.classList.contains('hidden');
            if (isHidden) {
                historySection.classList.remove('hidden');
                historySection.classList.add('flex');
                setTimeout(() => {
                    historyPanel.style.transform = 'translateY(0)';
                }, 10);
            } else {
                historyPanel.style.transform = 'translateY(100%)';
                setTimeout(() => {
                    historySection.classList.add('hidden');
                    historySection.classList.remove('flex');
                }, 300);
            }
            currentDisplayDate = new Date();
            updateHistory('all');
        }
        function exportHistoryToCSV() {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Mala Number,Date,Time\n";
            malaHistory.forEach(entry => {
                const entryDate = new Date(entry.timestamp);
                const date = entryDate.toLocaleDateString();
                const time = entryDate.toLocaleTimeString();
                const row = `${entry.malaNumber},${date},${time}`;
                csvContent += row + "\r\n";
            });
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "mala_history.csv");
            document.body.appendChild(link); 
            link.click();
            document.body.removeChild(link);
        }
        window.onload = () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.classList.add(`${savedTheme}-theme`);
            loadProgress();
            updateDisplay();
            document.getElementById('historySearchInput').addEventListener('input', () => updateHistory());
        };
    </script>
<style>
      body {
        min-height: max(884px, 100dvh);
      }
    </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  </head>
<body class="transition-colors duration-300">
<div class="flex flex-col min-h-screen bg-[var(--background-color)]">
<header class="flex justify-between items-center px-6 py-8">
<h1 class="text-4xl font-bold text-[var(--text-color)]">Counter App</h1>
<div class="flex items-center space-x-2">
<button class="text-[var(--text-color)]" onclick="toggleHistory()">
<span class="material-symbols-outlined custom-settings text-4xl">calendar_month</span>
</button>
<button class="text-[var(--text-color)]" onclick="toggleAchievements()">
<span class="material-symbols-outlined custom-settings text-4xl">emoji_events</span>
</button>
<button class="text-[var(--text-color)]" onclick="toggleSettings()">
<span class="material-symbols-outlined custom-settings text-4xl">settings</span>
</button>
</div>
</header>
<main class="flex-grow flex flex-col items-center justify-center text-center px-6">
<div class="relative w-64 h-64 sm:w-80 sm:h-80 flex items-center justify-center">
<div class="absolute inset-0 bg-[var(--card-bg)] rounded-full shadow-2xl"></div>
<span class="relative text-[28vw] sm:text-[12rem] font-extrabold text-[var(--text-color)] leading-none" id="counter">0</span>
</div>
<div class="w-full max-w-sm mt-8">
<div class="relative w-full bg-[var(--progress-bg)] rounded-full h-4">
<div class="bg-[var(--progress-fill)] h-4 rounded-full" id="progressBar" style="width: 37%;"></div>
<span class="absolute inset-0 flex items-center justify-center text-xs font-medium text-black" id="progressText">37%</span>
</div>
<p class="text-sm font-medium text-gray-500 dark:text-gray-400 mt-2" id="goalText">Goal: 108</p>
</div>
<div class="mt-4 text-center">
<span class="text-3xl font-semibold text-gray-400">Mala :- </span>
<span class="text-3xl font-bold text-[var(--text-color)]" id="mala">0</span>
</div>
</main>
<footer class="p-6">
<div class="grid grid-cols-2 gap-4 mb-4">
<button class="w-full h-14 flex items-center justify-center bg-gradient-to-br from-[var(--gradient-start)] to-[var(--gradient-end)] text-white font-bold rounded-2xl shadow-lg transform hover:scale-105 transition-transform" onclick="decrement()">
<span class="text-4xl pb-1">-</span>
</button>
<button class="w-full h-14 flex items-center justify-center bg-gradient-to-br from-[var(--gradient-start)] to-[var(--gradient-end)] text-white font-bold rounded-2xl shadow-lg transform hover:scale-105 transition-transform" onclick="increment()">
<span class="text-4xl pb-1">+</span>
</button>
</div>
<div class="grid grid-cols-1">
<button class="w-full h-16 flex items-center justify-center bg-gradient-to-br from-[var(--gradient-start)] to-[var(--gradient-end)] text-white text-xl font-bold rounded-2xl shadow-lg transform hover:scale-105 transition-transform" onclick="reset()">
<span>Reset</span>
</button>
</div>
</footer>
</div>
<div class="hidden fixed inset-0 bg-[var(--popup-bg)] backdrop-blur-sm z-50 flex items-end justify-center" id="historySection">
<div class="bg-[var(--popup-card-bg)] rounded-t-3xl p-4 w-full max-w-md max-h-[90vh] flex flex-col shadow-2xl transition-transform duration-300 ease-in-out transform translate-y-full" style="--tw-translate-y: 0;">
<div class="flex-shrink-0 text-center py-2">
<div class="inline-block w-10 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full cursor-pointer" onclick="toggleHistory()"></div>
</div>
<div class="flex justify-between items-center mb-4 px-2">
<h2 class="text-3xl font-bold text-[var(--text-color)]">History</h2>
<div class="flex items-center space-x-2">
<button class="text-[var(--text-color)] opacity-70 hover:opacity-100" onclick="exportHistoryToCSV()">
<span class="material-symbols-outlined text-3xl">ios_share</span>
</button>
<button class="text-[var(--text-color)] opacity-70 hover:opacity-100" onclick="toggleHistory()">
<span class="material-symbols-outlined text-3xl">close</span>
</button>
</div>
</div>
<div class="flex-grow overflow-y-auto px-2 pb-4">
<div class="mb-4">
<div class="flex justify-between items-center mb-4">
<button class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" onclick="changeMonth(-1)">
<span class="material-symbols-outlined text-3xl">chevron_left</span>
</button>
<h3 class="text-xl font-bold text-[var(--text-color)]" id="monthYearHeader">May 2024</h3>
<button class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" onclick="changeMonth(1)">
<span class="material-symbols-outlined text-3xl">chevron_right</span>
</button>
</div>
<div id="calendarView"></div>
</div>
<hr class="border-gray-200 dark:border-gray-700 my-4"/>
<div>
<div class="flex justify-between items-center mb-3">
<h3 class="text-xl font-bold text-[var(--text-color)]">Activity</h3>
<div class="relative">
<select class="appearance-none bg-[var(--achievement-bg)] border border-[var(--achievement-border)] text-[var(--text-color)] text-sm rounded-lg focus:ring-[var(--gradient-start)] focus:border-[var(--gradient-start)] block w-full p-2.5 pr-8" onchange="updateHistory(this.value)">
<option selected="" value="all">All Time</option>
<option value="today">Today</option>
<option value="this_week">This Week</option>
<option value="this_month">This Month</option>
</select>
<div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-[var(--text-color)]">
<span class="material-symbols-outlined text-lg">expand_more</span>
</div>
</div>
</div>
<div class="relative mb-4">
<input class="w-full p-3 pl-10 bg-gray-100 dark:bg-gray-700 text-[var(--text-color)] border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-[var(--gradient-start)] focus:border-[var(--gradient-start)]" id="historySearchInput" placeholder="Search by date or Mala..." type="text"/>
<div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
<span class="material-symbols-outlined text-gray-400">search</span>
</div>
</div>
<ul class="space-y-3" id="historyListView">
<li class="text-center text-gray-500 dark:text-gray-400 py-4">Select a date or filter to see your activity.</li>
</ul>
</div>
</div>
</div>
</div>
<div class="hidden fixed inset-0 bg-[var(--popup-bg)] backdrop-blur-sm z-50 flex items-end justify-center" id="achievementsSection">
<div class="bg-[var(--popup-card-bg)] rounded-t-3xl p-4 w-full max-w-md max-h-[85vh] flex flex-col shadow-2xl transition-transform duration-300 ease-in-out transform translate-y-full" style="--tw-translate-y: 0;">
<div class="flex-shrink-0 text-center py-2">
<div class="inline-block w-10 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full cursor-pointer" onclick="toggleAchievements()"></div>
</div>
<div class="flex justify-between items-center mb-4 px-2">
<h2 class="text-3xl font-bold text-[var(--text-color)]">Achievements</h2>
<button class="text-[var(--text-color)] opacity-70 hover:opacity-100" onclick="toggleAchievements()">
<span class="material-symbols-outlined text-3xl">close</span>
</button>
</div>
<ul class="space-y-3 overflow-y-auto px-2 pb-4" id="achievementsList">
</ul>
</div>
</div>
<div class="hidden fixed inset-0 bg-[var(--popup-bg)] backdrop-blur-sm z-50 flex items-end justify-center" id="settingsSection">
<div class="bg-[var(--popup-card-bg)] rounded-t-3xl p-4 w-full max-w-md flex flex-col shadow-2xl transition-transform duration-300 ease-in-out transform translate-y-full" style="--tw-translate-y: 0;">
<div class="flex-shrink-0 text-center py-2">
<div class="inline-block w-10 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full cursor-pointer" onclick="toggleSettings()"></div>
</div>
<div class="flex justify-between items-center mb-4 px-2">
<h2 class="text-3xl font-bold text-[var(--text-color)]">Settings</h2>
<button class="text-[var(--text-color)] opacity-70 hover:opacity-100" onclick="toggleSettings()">
<span class="material-symbols-outlined text-3xl">close</span>
</button>
</div>
<div class="px-2 pb-4 space-y-6">
<div>
<label class="block text-lg font-medium text-[var(--text-color)] mb-2" for="customGoalInput">Set Custom Mala Goal</label>
<input class="w-full p-3 bg-gray-100 dark:bg-gray-700 text-[var(--text-color)] border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-[var(--gradient-start)] focus:border-[var(--gradient-start)]" id="customGoalInput" name="customGoal" placeholder="e.g., 108" type="number"/>
</div>
<div class="flex items-center justify-between">
<span class="text-lg font-medium text-[var(--text-color)]">Theme</span>
<button class="text-[var(--text-color)]" onclick="toggleTheme()">
<span class="material-symbols-outlined custom-settings text-4xl">dark_mode</span>
</button>
</div>
<button class="w-full h-14 flex items-center justify-center bg-gradient-to-br from-[var(--gradient-start)] to-[var(--gradient-end)] text-white text-xl font-bold rounded-2xl shadow-lg transform hover:scale-105 transition-transform" onclick="setCustomGoal()">
<span>Save Settings</span>
</button>
</div>
</div>
</div>
<div class="hidden fixed bottom-10 right-10 bg-[var(--popup-card-bg)] text-[var(--text-color)] rounded-xl shadow-lg p-4 flex items-center space-x-4 z-50 animate-bounce" id="achievementPopup">
<span class="material-symbols-outlined text-4xl text-[var(--unlocked-icon-color)]" id="popupIcon">emoji_events</span>
<div>
<p class="font-bold text-lg" id="popupTitle">Achievement Unlocked!</p>
<p class="text-sm" id="popupMala">You've reached a new milestone!</p>
</div>
</div>
<script>
    // Script to handle the slide-up animation for the panels
    const achievementsSection = document.getElementById('achievementsSection');
    const achievementsPanel = achievementsSection.querySelector('div');
    const originalToggleAchievements = toggleAchievements;
    function enhancedToggleAchievements() {
        const isHidden = achievementsSection.classList.contains('hidden');
        if (isHidden) {
            achievementsSection.classList.remove('hidden');
            achievementsSection.classList.add('flex');
            setTimeout(() => {
                achievementsPanel.style.transform = 'translateY(0)';
            }, 10);
        } else {
            achievementsPanel.style.transform = 'translateY(100%)';
            setTimeout(() => {
                achievementsSection.classList.add('hidden');
                achievementsSection.classList.remove('flex');
            }, 300);
        }
        updateAchievements();
    }
    toggleAchievements = enhancedToggleAchievements;
    const historySection = document.getElementById('historySection');
    const historyPanel = historySection.querySelector('div');
    const originalToggleHistory = toggleHistory;
    function enhancedToggleHistory() {
        const isHidden = historySection.classList.contains('hidden');
        if (isHidden) {
            historySection.classList.remove('hidden');
            historySection.classList.add('flex');
            setTimeout(() => {
                historyPanel.style.transform = 'translateY(0)';
            }, 10);
        } else {
            historyPanel.style.transform = 'translateY(100%)';
            setTimeout(() => {
                historySection.classList.add('hidden');
                historySection.classList.remove('flex');
            }, 300);
        }
        currentDisplayDate = new Date();
        updateHistory('all');
    }
    toggleHistory = enhancedToggleHistory;
</script>
</body></html>